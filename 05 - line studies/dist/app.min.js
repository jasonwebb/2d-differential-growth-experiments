"use strict";function _typeof2(e){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof2(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function o(s,a,u){function h(t,e){if(!a[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=a[t]={exports:{}};s[t][0].call(i.exports,function(e){return h(s[t][1][e]||e)},i,i.exports,o,s,a,u)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)h(u[e]);return h}({1:[function(e,t,n){t.exports={MinDistance:1,MaxDistance:5,RepulsionRadius:10,AttractionForce:.2,RepulsionForce:.6,AlignmentForce:.55,NodeInjectionInterval:100,DrawNodes:!1,TraceMode:!0,InvertedColors:!0,DebugMode:!1,FillMode:!1}},{}],2:[function(e,t,n){var f,p=e("../../core/Node"),y=e("../../core/Path"),r=e("../../core/World"),v=e("./Settings"),i=e("../../core/MIDIControl"),a=4;new p5(function(d){function e(e,t,n,r,i,o){for(var s=r*t,a=n*e,u=0;u<e;u++)for(var h=0;h<t;h++){var l=[];l.push(new p(d,h*r+window.innerWidth/2-s/2,u*n+window.innerHeight/2-a/2+n/2,v)),l.push(new p(d,h*r+window.innerWidth/2+i-s/2,u*n+window.innerHeight/2+o-a/2+n/2,v)),f.addPath(new y(d,l,v))}}function n(e,t,n,r,i,o,s){for(var a=(r-n)/o,u=i+s,h=n;h<r;h+=a){var l=[];l[0]=new p(d,i*Math.cos(h*(Math.PI/180)),i*Math.sin(h*(Math.PI/180)),v),l[1]=new p(d,u*Math.cos(h*(Math.PI/180)),u*Math.sin(h*(Math.PI/180)),v);var c=new y(d,l,v);c.moveTo(e,t),f.addPath(c)}}function s(){switch(f.clearPaths(),a){case 0:e(30,10,20,45,30,0);break;case 1:e(10,30,38,20,0,30);break;case 2:e(15,20,38,20,-30,30);break;case 3:n(window.innerWidth/2,window.innerHeight/2,0,360,75,60,50);break;case 4:n(window.innerWidth/2-450+100,window.innerHeight/2+450-75,270,360,375,66,100),n(window.innerWidth/2+450-100,window.innerHeight/2-450+75,90,180,375,60,100);break;case 5:!function(){for(var e=[{x:-200,y:-210,ds:0,de:360,r:25,lpa:55,ll:100},{x:60,y:-100,ds:0,de:360,r:25,lpa:30,ll:35},{x:-80,y:-20,ds:0,de:360,r:50,lpa:45,ll:25},{x:150,y:150,ds:0,de:360,r:100,lpa:60,ll:70},{x:-40,y:-150,ds:0,de:360,r:15,lpa:18,ll:10},{x:-400,y:400,ds:270,de:360,r:400,lpa:60,ll:30},{x:-400,y:400,ds:270,de:360,r:350,lpa:15,ll:20},{x:-400,y:400,ds:270,de:360,r:300,lpa:7,ll:40},{x:-400,y:400,ds:270,de:360,r:200,lpa:30,ll:75},{x:125,y:-400,ds:0,de:180,r:175,lpa:45,ll:30},{x:275,y:-110,ds:0,de:360,r:75,lpa:45,ll:15}],t=0;t<e.length;t++)n(window.innerWidth/2+e[t].x,window.innerHeight/2+e[t].y,e[t].ds,e[t].de,e[t].r,e[t].lpa,e[t].ll)}()}f.drawBackground(),f.draw(),f.pause(),setTimeout(function(){},1e3)}d.setup=function(){d.createCanvas(window.innerWidth,window.innerHeight),d.colorMode(d.HSB,255),d.rectMode(d.CENTER),f=new r(d,v),s(),this.midi=new i,document.addEventListener("noteon",function(e){console.log(e.detail)}),document.addEventListener("controlchange",function(e){console.log(e.detail)})},d.draw=function(){f.iterate(),f.draw(),d.noFill(),f.invertedColors?d.stroke(255):d.stroke(0),d.rect(window.innerWidth/2,window.innerHeight/2,800,800)},d.keyReleased=function(){switch(d.key){case"1":a=0,s();break;case"2":a=1,s();break;case"3":a=2,s();break;case"4":a=3,s();break;case"5":a=4,s();break;case"6":a=5,s();break;case"t":f.toggleTraceMode();break;case"n":f.toggleDrawNodes();break;case"r":s();break;case" ":f.paused=!f.paused;var e=0,t=!0,n=!1,r=void 0;try{for(var i,o=f.paths[Symbol.iterator]();!(t=(i=o.next()).done);t=!0)e+=i.value.nodes.length}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}console.log(e);break;case"i":f.toggleInvertedColors();break;case"d":f.toggleDebugMode();break;case"f":f.toggleFillMode();break;case"h":f.toggleDrawHistory();break;case"s":f.export()}}})},{"../../core/MIDIControl":4,"../../core/Node":5,"../../core/Path":6,"../../core/World":7,"./Settings":1}],3:[function(e,t,n){t.exports={MinDistance:20,MaxDistance:30,RepulsionRadius:20,MaxVelocity:.1,AttractionForce:.001,RepulsionForce:500,AlignmentForce:.001,NodeInjectionInterval:100,DrawNodes:!1,TraceMode:!1,InvertedColors:!1,DebugMode:!1,FillMode:!1,DrawHistory:!0,HistoryCaptureInterval:1e3,MaxHistorySize:20,UseBrownianMotion:!0,BrownianMotionRange:.01}},{}],4:[function(e,t,n){var r=e("./node_modules/webmidi");t.exports=function e(){_classCallCheck(this,e),r.enable(function(e){e?console.log(e):(this.lpd8=r.getInputByName("Akai LPD8 Wireless"),this.lpd8&&(this.lpd8.addListener("noteon","all",function(e){var t=new CustomEvent("noteon",{detail:{note:e.note.number,velocity:e.velocity}});document.dispatchEvent(t)}),this.lpd8.addListener("controlchange","all",function(e){var t=new CustomEvent("controlchange",{detail:{controller:e.controller.number,value:e.value}});document.dispatchEvent(t)})))})}},{"./node_modules/webmidi":18}],5:[function(e,t,n){var h=e("./node_modules/vec2"),l=e("./Defaults"),r=function(e){function u(e,t,n){var r,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:l,o=4<arguments.length&&void 0!==arguments[4]&&arguments[4],s=5<arguments.length?arguments[5]:void 0,a=6<arguments.length?arguments[6]:void 0;return _classCallCheck(this,u),(r=_possibleConstructorReturn(this,_getPrototypeOf(u).call(this,t,n))).p5=e,r.isFixed=o,r.settings=Object.assign({},l,i),r.velocity=0,r.nextPosition=new h(t,n),r.minDistance=s||i.MinDistance,r.repulsionRadius=a||i.RepulsionRadius,r}return _inherits(u,h),_createClass(u,[{key:"iterate",value:function(){this.isFixed||(this.x=this.p5.lerp(this.x,this.nextPosition.x,this.settings.MaxVelocity),this.y=this.p5.lerp(this.y,this.nextPosition.y,this.settings.MaxVelocity))}},{key:"draw",value:function(){this.isFixed?this.p5.ellipse(this.x,this.y,20):this.p5.ellipse(this.x,this.y,5)}}]),u}();t.exports=r},{"./Defaults":3,"./node_modules/vec2":17}],6:[function(e,t,n){var h=e("./node_modules/rbush-knn"),l=e("./Node"),c=e("./Defaults"),r=function(){function u(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:c,r=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{h:0,s:0,b:0,a:255},o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{h:0,s:0,b:0,a:255},s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:{h:0,s:0,b:255,a:255},a=7<arguments.length&&void 0!==arguments[7]?arguments[7]:{h:0,s:0,b:255,a:255};_classCallCheck(this,u),this.p5=e,this.nodes=t,this.isClosed=r,this.settings=Object.assign({},c,n),this.injectionMode="RANDOM",this.lastNodeInjectTime=0,this.nodeHistory=[],this.drawNodes=this.settings.DrawNodes,this.invertedColors=this.settings.InvertedColors,this.traceMode=this.settings.TraceMode,this.debugMode=this.settings.DebugMode,this.fillMode=this.settings.FillMode,this.useBrownianMotion=this.settings.UseBrownianMotion,this.drawHistory=this.settings.DrawHistory,this.fillColor=i,this.strokeColor=o,this.invertedFillColor=s,this.invertedStrokeColor=a,this.currentFillColor=this.fillColor,this.currentStrokeColor=this.strokeColor,this.invertedColors&&(this.currentFillColor=this.invertedFillColor,this.currentStrokeColor=this.invertedStrokeColor)}return _createClass(u,[{key:"iterate",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.nodes.entries()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=_slicedToArray(i.value,2),a=s[0],u=s[1];this.useBrownianMotion&&this.applyBrownianMotion(a),this.applyAttraction(a),this.applyRepulsion(a,e),this.applyAlignment(a),this.avoidWalls(a),u.iterate()}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}this.splitEdges(),this.pruneNodes(),this.p5.millis()-this.lastNodeInjectTime>=this.settings.NodeInjectionInterval&&(this.injectNode(),this.lastNodeInjectTime=this.p5.millis())}},{key:"applyBrownianMotion",value:function(e){this.nodes[e].x+=this.p5.random(-this.settings.BrownianMotionRange/2,this.settings.BrownianMotionRange/2),this.nodes[e].y+=this.p5.random(-this.settings.BrownianMotionRange/2,this.settings.BrownianMotionRange/2)}},{key:"applyAttraction",value:function(e){var t,n=this.getConnectedNodes(e);null!=n.nextNode&&n.nextNode instanceof l&&!this.nodes[e].isFixed&&(t=this.nodes[e].distance(n.nextNode),Math.min(this.nodes[e].minDistance,n.nextNode.minDistance)<t&&(this.nodes[e].nextPosition.x=this.p5.lerp(this.nodes[e].nextPosition.x,n.nextNode.x,this.settings.AttractionForce),this.nodes[e].nextPosition.y=this.p5.lerp(this.nodes[e].nextPosition.y,n.nextNode.y,this.settings.AttractionForce))),null!=n.previousNode&&n.previousNode instanceof l&&!this.nodes[e].isFixed&&(t=this.nodes[e].distance(n.previousNode),Math.min(this.nodes[e].minDistance,n.previousNode.minDistance)<t&&(this.nodes[e].nextPosition.x=this.p5.lerp(this.nodes[e].nextPosition.x,n.previousNode.x,this.settings.AttractionForce),this.nodes[e].nextPosition.y=this.p5.lerp(this.nodes[e].nextPosition.y,n.previousNode.y,this.settings.AttractionForce)))}},{key:"applyRepulsion",value:function(e,t){var n=h(t,this.nodes[e].x,this.nodes[e].y,void 0,void 0,this.nodes[e].repulsionRadius*this.nodes[e].repulsionRadius),r=!0,i=!1,o=void 0;try{for(var s,a=n[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var u=s.value;this.nodes[e].nextPosition.x=this.p5.lerp(this.nodes[e].x,u.x,-this.settings.RepulsionForce),this.nodes[e].nextPosition.y=this.p5.lerp(this.nodes[e].y,u.y,-this.settings.RepulsionForce)}}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}}},{key:"applyAlignment",value:function(e){var t=this.getConnectedNodes(e);if(null!=t.previousNode&&t.previousNode instanceof l&&null!=t.nextNode&&t.nextNode instanceof l&&!this.nodes[e].isFixed){var n=this.getMidpointNode(t.previousNode,t.nextNode);this.nodes[e].nextPosition.x=this.p5.lerp(this.nodes[e].nextPosition.x,n.x,this.settings.AlignmentForce),this.nodes[e].nextPosition.y=this.p5.lerp(this.nodes[e].nextPosition.y,n.y,this.settings.AlignmentForce)}}},{key:"splitEdges",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.nodes.entries()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=_slicedToArray(r.value,2),s=o[0],a=o[1],u=this.getConnectedNodes(s);if(null!=u.previousNode&&u.previousNode instanceof l&&a.distance(u.previousNode)>=this.settings.MaxDistance){var h=this.getMidpointNode(a,u.previousNode);0==s?this.nodes.splice(this.nodes.length,0,h):this.nodes.splice(s,0,h)}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"pruneNodes",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.nodes.entries()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=_slicedToArray(r.value,2),s=o[0],a=o[1],u=this.getConnectedNodes(s);null!=u.previousNode&&u.previousNode instanceof l&&a.distance(u.previousNode)<this.settings.MinDistance&&(0==s?this.nodes[this.nodes.length-1].isFixed||this.nodes.splice(this.nodes.length-1,1):this.nodes[s-1].isFixed||this.nodes.splice(s-1,1))}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"injectNode",value:function(){switch(this.injectionMode){case"RANDOM":this.injectRandomNode();break;case"CURVATURE":this.injectNodeByCurvature()}}},{key:"injectRandomNode",value:function(){var e=parseInt(this.p5.random(1,this.nodes.length)),t=this.getConnectedNodes(e);if(null!=t.previousNode&&t.previousNode instanceof l&&null!=t.nextNode&&t.nextNode instanceof l&&this.nodes[e].distance(t.previousNode)>this.settings.MinDistance){var n=this.getMidpointNode(this.nodes[e],t.previousNode);this.nodes.splice(e,0,n)}}},{key:"injectNodeByCurvature",value:function(){console.log("test");var e=!0,t=!1,n=void 0;try{for(var r,i=this.nodes.entries()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=_slicedToArray(r.value,2),s=o[0],a=o[1],u=this.getConnectedNodes(s),h=a.distance(u.previousNode),l=a.distance(u.nextNode);if(180*Math.atan(h/l)/Math.PI<30){console.log(s);var c=this.getMidpointNode(a,u.previousNode),d=this.getMidpointNode(a,u.nextNode);console.log(c),console.log(d),this.p5.noLoop(),0==s?(this.nodes.splice(this.nodes.length-1,0,c),this.nodes.splice(0,1,d)):this.nodes.splice(s,1,c,d)}}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"avoidWalls",value:function(e){this.nodes[e].x=this.p5.constrain(this.nodes[e].x,0,window.innerWidth),this.nodes[e].y=this.p5.constrain(this.nodes[e].y,0,window.innerHeight)}},{key:"getConnectedNodes",value:function(e){var t,n;return 0==e&&this.isClosed?t=this.nodes[this.nodes.length-1]:1<=e&&(t=this.nodes[e-1]),e==this.nodes.length-1&&this.isClosed?n=this.nodes[0]:e<=this.nodes.length-1&&(n=this.nodes[e+1]),{previousNode:t,nextNode:n}}},{key:"getMidpointNode",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return new l(this.p5,(e.x+t.x)/2,(e.y+t.y)/2,this.settings,n)}},{key:"draw",value:function(){this.drawHistory&&this.drawPreviousEdges(),this.fillMode?this.p5.fill(this.currentFillColor.h,this.currentFillColor.s,this.currentFillColor.b,this.currentFillColor.a):this.p5.noFill(),this.p5.stroke(this.currentStrokeColor.h,this.currentStrokeColor.s,this.currentStrokeColor.b,this.currentStrokeColor.a),this.drawCurrentEdges(),this.drawNodes&&this.drawCurrentNodes()}},{key:"drawCurrentEdges",value:function(){this.drawEdges(this.nodes)}},{key:"drawPreviousEdges",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.nodeHistory.entries()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=_slicedToArray(r.value,2),s=o[0],a=o[1];this.p5.stroke(this.currentStrokeColor.h,this.currentStrokeColor.s,this.currentStrokeColor.b,30*s),this.drawEdges(a)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"drawEdges",value:function(e){this.debugMode||this.p5.beginShape();for(var t=0;t<e.length;t++)this.debugMode?0<t&&(this.traceMode?this.p5.stroke(this.p5.map(t,0,e.length-1,0,255,!0),255,255,2):this.p5.stroke(this.p5.map(t,0,e.length-1,0,255,!0),255,255,255),this.p5.line(e[t-1].x,e[t-1].y,e[t].x,e[t].y)):this.p5.vertex(e[t].x,e[t].y);this.isClosed&&(this.debugMode?this.p5.line(e[e.length-1].x,e[e.length-1].y,e[0].x,e[0].y):this.p5.vertex(e[0].x,e[0].y)),this.debugMode||this.p5.endShape()}},{key:"drawCurrentNodes",value:function(){this.p5.noStroke(),this.invertedColors?this.p5.fill(255):this.p5.fill(0);var e=!0,t=!1,n=void 0;try{for(var r,i=this.nodes.entries()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=_slicedToArray(r.value,2),s=o[0],a=o[1];this.debugMode&&this.p5.fill(this.p5.map(s,0,this.nodes.length-1,0,255,!0),255,255,255),a.draw()}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"addToHistory",value:function(){this.nodeHistory.length==this.settings.MaxHistorySize&&this.nodeHistory.shift(),this.nodeHistory.push(Object.assign([],JSON.parse(JSON.stringify(this.nodes))))}},{key:"moveTo",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,s=this.nodes[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;a.x+=e,a.y+=t}}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}}},{key:"scale",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.nodes[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;s.x*=e,s.y*=e}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"addNode",value:function(e){this.nodes.push(e)}},{key:"getTraceMode",value:function(){return this.traceMode}},{key:"getInvertedColors",value:function(){return this.invertedColors}},{key:"setTraceMode",value:function(e){this.traceMode=e,this.traceMode,this.currentFillColor.a=255,this.currentStrokeColor.a=255}},{key:"setInvertedColors",value:function(e){this.invertedColors=e,this.invertedColors?(this.currentFillColor=this.invertedFillColor,this.currentStrokeColor=this.invertedStrokeColor):(this.currentFillColor=this.fillColor,this.currentStrokeColor=this.strokeColor),this.setTraceMode(this.traceMode)}},{key:"toggleTraceMode",value:function(){this.setTraceMode(!this.getTraceMode())}},{key:"toggleInvertedColors",value:function(){this.setInvertedColors(!this.getInvertedColors())}}]),u}();t.exports=r},{"./Defaults":3,"./Node":5,"./node_modules/rbush-knn":10}],7:[function(e,t,n){var o=e("./node_modules/rbush"),x=e("./node_modules/svg-points/").toPath,_=e("./node_modules/file-saver").saveAs,s=e("./Defaults"),r=function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];_classCallCheck(this,i),this.p5=e,this.paths=n,this.paused=!1,this.settings=Object.assign({},s,t),this.traceMode=this.settings.TraceMode,this.drawNodes=this.settings.DrawNodes,this.debugMode=this.settings.DebugMode,this.invertedColors=this.settings.InvertedColors,this.fillMode=this.settings.FillMode,this.drawHistory=this.settings.DrawHistory,this.useBrownianMotion=this.settings.UseBrownianMotion,this.tree=o(9,[".x",".y",".x",".y"]),this.buildTree();var r=this;setInterval(function(){r.addToHistory()},this.settings.HistoryCaptureInterval)}return _createClass(i,[{key:"iterate",value:function(){if(this.buildTree(),null!=this.paths&&this.paths instanceof Array&&0<this.paths.length&&!this.paused){var e=!0,t=!1,n=void 0;try{for(var r,i=this.paths[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){r.value.iterate(this.tree)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}},{key:"draw",value:function(){if(!this.paused){this.traceMode||this.drawBackground();var e=!0,t=!1,n=void 0;try{for(var r,i=this.paths[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){r.value.draw()}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}},{key:"drawBackground",value:function(){this.invertedColors?this.p5.background(0):this.p5.background(255)}},{key:"buildTree",value:function(){this.tree.clear();var e=!0,t=!1,n=void 0;try{for(var r,i=this.paths[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;this.tree.load(o.nodes)}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"addPath",value:function(e){e.drawNodes=this.drawNodes,e.debugMode=this.debugMode,e.fillMode=this.fillMode,e.useBrownianMotion=this.useBrownianMotion,e.setInvertedColors(this.invertedColors),e.setTraceMode(this.traceMode),this.paths.push(e)}},{key:"addPaths",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;this.addPath(s)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}},{key:"addToHistory",value:function(){if(!this.paused){var e=!0,t=!1,n=void 0;try{for(var r,i=this.paths[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){r.value.addToHistory()}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}}},{key:"export",value:function(){var e=document.createElement("svg");e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),e.setAttribute("width",window.innerWidth),e.setAttribute("height",window.innerHeight),e.setAttribute("viewBox","0 0 "+window.innerWidth+" "+window.innerHeight);var t=!0,n=!1,r=void 0;try{for(var i,o=this.paths[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value,a="",u=!0,h=!1,l=void 0;try{for(var c,d=s.nodes.entries()[Symbol.iterator]();!(u=(c=d.next()).done);u=!0){var f=_slicedToArray(c.value,2),p=f[0],y=f[1];a+=y.x+","+y.y,p<s.nodes.length-1&&(a+=" ")}}catch(e){h=!0,l=e}finally{try{u||null==d.return||d.return()}finally{if(h)throw l}}var v=x({type:"polyline",points:a});s.isClosed&&(v+=" Z");var m=document.createElement("path");m.setAttribute("d",v),m.setAttribute("style","fill: none; stroke: black; stroke-width: 1"),e.appendChild(m)}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}var g=document.implementation.createDocumentType("svg","-//W3C//DTD SVG 1.1//EN","http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"),b=document.implementation.createDocument("http://www.w3.org/2000/svg","svg",g);b.replaceChild(e,b.documentElement);var w=(new XMLSerializer).serializeToString(b),M=new Blob([w.replace(/></g,">\n\r<")]);_(M,"differential-growth-"+Date.now()+".svg")}},{key:"clearPaths",value:function(){this.paths=[]}},{key:"pause",value:function(){this.paused=!0}},{key:"unpause",value:function(){this.paused=!1}},{key:"getDrawNodes",value:function(){return this.drawNodes}},{key:"getDebugMode",value:function(){return this.debugMode}},{key:"getFillMode",value:function(){return this.fillMode}},{key:"getDrawHistory",value:function(){return this.drawHistory}},{key:"setDrawNodes",value:function(e){this.drawBackground();var t=!0,n=!1,r=void 0;try{for(var i,o=this.paths[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;s.drawNodes=e,s.draw()}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}this.drawNodes=e}},{key:"setDebugMode",value:function(e){this.drawBackground();var t=!0,n=!1,r=void 0;try{for(var i,o=this.paths[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;s.debugMode=e,s.draw()}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}this.debugMode=e}},{key:"setFillMode",value:function(e){this.drawBackground();var t=!0,n=!1,r=void 0;try{for(var i,o=this.paths[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;s.fillMode=e,s.draw()}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}this.fillMode=e}},{key:"setDrawHistory",value:function(e){this.drawBackground();var t=!0,n=!1,r=void 0;try{for(var i,o=this.paths[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;s.drawHistory=e,s.draw()}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}this.drawHistory=e}},{key:"toggleDrawNodes",value:function(){this.setDrawNodes(!this.getDrawNodes())}},{key:"toggleTraceMode",value:function(){this.traceMode=!this.traceMode,this.drawBackground();var e=!0,t=!1,n=void 0;try{for(var r,i=this.paths[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;o.toggleTraceMode(),o.draw()}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"toggleInvertedColors",value:function(){this.invertedColors=!this.invertedColors,this.drawBackground();var e=!0,t=!1,n=void 0;try{for(var r,i=this.paths[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;o.toggleInvertedColors(),o.draw()}}catch(e){t=!0,n=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}}},{key:"toggleDebugMode",value:function(){this.setDebugMode(!this.getDebugMode())}},{key:"toggleFillMode",value:function(){this.setFillMode(!this.getFillMode())}},{key:"toggleDrawHistory",value:function(){this.setDrawHistory(!this.getDrawHistory())}}]),i}();t.exports=r},{"./Defaults":3,"./node_modules/file-saver":8,"./node_modules/rbush":11,"./node_modules/svg-points/":12}],8:[function(e,r,i){(function(t){var e,n;e=this,n=function(){function l(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){i(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()}function s(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),200<=t.status&&t.status<=299}function o(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(e){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}}var c=function(){try{return Function("return this")()||(0,eval)("this")}catch(e){return"object"==("undefined"==typeof window?"undefined":_typeof2(window))&&window.window===window?window:"object"==("undefined"==typeof self?"undefined":_typeof2(self))&&self.self===self?self:"object"==_typeof2(t)&&t.global===t?t:this}}(),i=c.saveAs||"object"!=("undefined"==typeof window?"undefined":_typeof2(window))||window!==c?function(){}:"download"in HTMLAnchorElement.prototype?function(e,t,n){var r=c.URL||c.webkitURL,i=document.createElement("a");t=t||e.name||"download",i.download=t,i.rel="noopener","string"==typeof e?(i.href=e,i.origin===location.origin?o(i):s(i.href)?l(e,t,n):o(i,i.target="_blank")):(i.href=r.createObjectURL(e),setTimeout(function(){r.revokeObjectURL(i.href)},4e4),setTimeout(function(){o(i)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,n){if(t=t||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob((i=e,void 0===(o=n)?o={autoBom:!1}:"object"!=_typeof2(o)&&(console.warn("Depricated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\ufeff",i],{type:i.type}):i),t);else if(s(e))l(e,t,n);else{var r=document.createElement("a");r.href=e,r.target="_blank",setTimeout(function(){clikc(r)})}var i,o}:function(e,t,n,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),"string"==typeof e)return l(e,t,n);var i="application/octet-stream"===e.type,o=/constructor/i.test(c.HTMLElement)||c.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent);if((s||i&&o)&&"object"==("undefined"==typeof FileReader?"undefined":_typeof2(FileReader))){var a=new FileReader;a.onloadend=function(){var e=a.result;e=s?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=e:location=e,r=null},a.readAsDataURL(e)}else{var u=c.URL||c.webkitURL,h=u.createObjectURL(e);r?r.location=h:location.href=h,r=null,setTimeout(function(){u.revokeObjectURL(h)},4e4)}};r.exports=c.saveAs=i.saveAs=i},"function"==typeof define&&define.amd?define([],n):void 0!==i?n():(n(),e.FileSaver={})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(e,t,n){var r,i;r=this,i=function(){function v(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function o(e,t){return e<t?-1:t<e?1:0}return function(e,t,n,r,i){!function e(t,n,r,i,o){for(;r<i;){if(600<i-r){var s=i-r+1,a=n-r+1,u=Math.log(s),h=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*h*(s-h)/s)*(a-s/2<0?-1:1),c=Math.max(r,Math.floor(n-a*h/s+l)),d=Math.min(i,Math.floor(n+(s-a)*h/s+l));e(t,n,c,d,o)}var f=t[n],p=r,y=i;for(v(t,r,n),0<o(t[i],f)&&v(t,r,i);p<y;){for(v(t,p,y),p++,y--;o(t[p],f)<0;)p++;for(;0<o(t[y],f);)y--}0===o(t[r],f)?v(t,r,y):v(t,++y,i),y<=n&&(r=y+1),n<=y&&(i=y-1)}}(e,t,n||0,r||e.length-1,i||o)}},"object"===_typeof2(n)&&void 0!==t?t.exports=i():"function"==typeof define&&define.amd?define(i):r.quickselect=i()},{}],10:[function(e,t,n){var b=e("tinyqueue");function r(e,t,n,r,i,o){for(var s,a,u,h,l,c,d,f,p,y=e.data,v=[],m=e.toBBox,g=new b(null,w);y;){for(s=0;s<y.children.length;s++)a=y.children[s],l=t,c=n,d=y.leaf?m(a):a,void 0,f=M(l,d.minX,d.maxX),p=M(c,d.minY,d.maxY),u=f*f+p*p,(!o||u<=o)&&g.push({node:a,isItem:y.leaf,dist:u});for(;g.length&&g.peek().isItem;)if(h=g.pop().node,i&&!i(h)||v.push(h),r&&v.length===r)return v;(y=g.pop())&&(y=y.node)}return v}function w(e,t){return e.dist-t.dist}function M(e,t,n){return e<t?t-e:e<=n?0:e-n}t.exports=r,t.exports.default=r},{tinyqueue:16}],11:[function(e,t,n){t.exports=r,t.exports.default=r;var a=e("quickselect");function r(e,t){if(!(this instanceof r))return new r(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}function l(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function f(e,t){m(e,0,e.children.length,t,e)}function m(e,t,n,r,i){i||(i=y(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o,s=t;s<n;s++)o=e.children[s],c(i,e.leaf?r(o):o);return i}function c(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function o(e,t){return e.minX-t.minX}function s(e,t){return e.minY-t.minY}function g(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function p(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function h(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function y(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function v(e,t,n,r,i){for(var o,s=[t,n];s.length;)(n=s.pop())-(t=s.pop())<=r||(o=t+Math.ceil((n-t)/r/2)*r,a(e,o,t,n,i),s.push(t,o,o,n))}r.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,n=[],r=this.toBBox;if(!h(e,t))return n;for(var i,o,s,a,u=[];t;){for(i=0,o=t.children.length;i<o;i++)s=t.children[i],h(e,a=t.leaf?r(s):s)&&(t.leaf?n.push(s):p(e,a)?this._all(s,n):u.push(s));t=u.pop()}return n},collides:function(e){var t=this.data,n=this.toBBox;if(!h(e,t))return!1;for(var r,i,o,s,a=[];t;){for(r=0,i=t.children.length;r<i;r++)if(o=t.children[r],h(e,s=t.leaf?n(o):o)){if(t.leaf||p(e,s))return!0;a.push(o)}t=a.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,n=e.length;t<n;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=y([]),this},remove:function(e,t){if(!e)return this;for(var n,r,i,o,s=this.data,a=this.toBBox(e),u=[],h=[];s||u.length;){if(s||(s=u.pop(),r=u[u.length-1],n=h.pop(),o=!0),s.leaf&&-1!==(i=l(e,s.children,t)))return s.children.splice(i,1),u.push(s),this._condense(u),this;o||s.leaf||!p(s,a)?r?(n++,s=r.children[n],o=!1):s=null:(u.push(s),h.push(n),n=0,s=(r=s).children[0])}return this},toBBox:function(e){return e},compareMinX:o,compareMinY:s,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},_build:function(e,t,n,r){var i,o=n-t+1,s=this._maxEntries;if(o<=s)return f(i=y(e.slice(t,n+1)),this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,r-1))),(i=y([])).leaf=!1,i.height=r;var a,u,h,l,c=Math.ceil(o/s),d=c*Math.ceil(Math.sqrt(s));for(v(e,t,n,d,this.compareMinX),a=t;a<=n;a+=d)for(v(e,a,h=Math.min(a+d-1,n),c,this.compareMinY),u=a;u<=h;u+=c)l=Math.min(u+c-1,h),i.children.push(this._build(e,u,l,r-1));return f(i,this.toBBox),i},_chooseSubtree:function(e,t,n,r){for(var i,o,s,a,u,h,l,c,d,f;r.push(t),!t.leaf&&r.length-1!==n;){for(l=c=1/0,i=0,o=t.children.length;i<o;i++)u=g(s=t.children[i]),d=e,f=s,(h=(Math.max(f.maxX,d.maxX)-Math.min(f.minX,d.minX))*(Math.max(f.maxY,d.maxY)-Math.min(f.minY,d.minY))-u)<c?(c=h,l=u<l?u:l,a=s):h===c&&u<l&&(l=u,a=s);t=a||t.children[0]}return t},_insert:function(e,t,n){var r=this.toBBox,i=n?e:r(e),o=[],s=this._chooseSubtree(i,this.data,t,o);for(s.children.push(e),c(s,i);0<=t&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(i,o,t)},_split:function(e,t){var n=e[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),s=y(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,f(n,this.toBBox),f(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(e,t){this.data=y([e,t]),this.data.height=e.height+1,this.data.leaf=!1,f(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,n){var r,i,o,s,a,u,h,l,c,d,f,p,y,v;for(u=h=1/0,r=t;r<=n-t;r++)i=m(e,0,r,this.toBBox),o=m(e,r,n,this.toBBox),c=i,d=o,void 0,f=Math.max(c.minX,d.minX),p=Math.max(c.minY,d.minY),y=Math.min(c.maxX,d.maxX),v=Math.min(c.maxY,d.maxY),s=Math.max(0,y-f)*Math.max(0,v-p),a=g(i)+g(o),s<u?(u=s,l=r,h=a<h?a:h):s===u&&a<h&&(h=a,l=r);return l},_chooseSplitAxis:function(e,t,n){var r=e.leaf?this.compareMinX:o,i=e.leaf?this.compareMinY:s;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)},_allDistMargin:function(e,t,n,r){e.children.sort(r);var i,o,s=this.toBBox,a=m(e,0,t,s),u=m(e,n-t,n,s),h=d(a)+d(u);for(i=t;i<n-t;i++)o=e.children[i],c(a,e.leaf?s(o):o),h+=d(a);for(i=n-t-1;t<=i;i--)o=e.children[i],c(u,e.leaf?s(o):o),h+=d(u);return h},_adjustParentBBoxes:function(e,t,n){for(var r=n;0<=r;r--)c(t[r],e)},_condense:function(e){for(var t,n=e.length-1;0<=n;n--)0===e[n].children.length?0<n?(t=e[n-1].children).splice(t.indexOf(e[n]),1):this.clear():f(e[n],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}},{quickselect:9}],12:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.valid=n.toPoints=n.toPath=void 0;var r=s(e("./toPath")),i=s(e("./toPoints")),o=s(e("./valid"));function s(e){return e&&e.__esModule?e:{default:e}}n.toPath=r.default,n.toPoints=i.default,n.valid=o.default},{"./toPath":13,"./toPoints":14,"./valid":15}],13:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r,i=e("./toPoints"),o=(r=i)&&r.__esModule?r:{default:r};var s=function(e){var t="",n=0,r=void 0,i=!0,o=!1,s=void 0;try{for(var a,u=e[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var h=a.value,l=h.curve,c=void 0!==l&&l,d=h.moveTo,f=h.x,p=h.y,y=0===n||d,v=n===e.length-1||e[n+1].moveTo,m=0===n?null:e[n-1];if(y)r=h,v||(t+="M"+f+","+p);else if(c){switch(c.type){case"arc":var g=h.curve,b=g.largeArcFlag,w=void 0===b?0:b,M=g.rx,x=g.ry,_=g.sweepFlag,E=void 0===_?0:_,S=g.xAxisRotation;t+="A"+M+","+x+","+(void 0===S?0:S)+","+w+","+E+","+f+","+p;break;case"cubic":var I=h.curve;t+="C"+I.x1+","+I.y1+","+I.x2+","+I.y2+","+f+","+p;break;case"quadratic":var N=h.curve;t+="Q"+N.x1+","+N.y1+","+f+","+p}v&&f===r.x&&p===r.y&&(t+="Z")}else v&&f===r.x&&p===r.y?t+="Z":f!==m.x&&p!==m.y?t+="L"+f+","+p:f!==m.x?t+="H"+f:p!==m.y&&(t+="V"+p);n++}}catch(e){o=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw s}}return t};n.default=function(e){var t=Array.isArray(e),n=t?Array.isArray(e[0]):"g"===e.type,r=t?e:n?e.shapes.map(function(e){return(0,o.default)(e)}):(0,o.default)(e);return n?r.map(function(e){return s(e)}):s(r)}},{"./toPoints":14}],14:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};var i=function(e){var t=e.type,n=function(e,t){var n={};for(var r in e)0<=t.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["type"]);switch(t){case"circle":return o(n);case"ellipse":return s(n);case"line":return a(n);case"path":return u(n);case"polygon":return h(n);case"polyline":return l(n);case"rect":return d(n);case"g":return y(n);default:throw new Error("Not a valid shape type")}},o=function(e){var t=e.cx,n=e.cy,r=e.r;return[{x:t,y:n-r,moveTo:!0},{x:t,y:n+r,curve:{type:"arc",rx:r,ry:r,sweepFlag:1}},{x:t,y:n-r,curve:{type:"arc",rx:r,ry:r,sweepFlag:1}}]},s=function(e){var t=e.cx,n=e.cy,r=e.rx,i=e.ry;return[{x:t,y:n-i,moveTo:!0},{x:t,y:n+i,curve:{type:"arc",rx:r,ry:i,sweepFlag:1}},{x:t,y:n-i,curve:{type:"arc",rx:r,ry:i,sweepFlag:1}}]},a=function(e){var t=e.x1,n=e.x2;return[{x:t,y:e.y1,moveTo:!0},{x:n,y:e.y2}]},G=/[MmLlHhVvCcSsQqTtAaZz]/g,L={A:7,C:6,H:1,L:2,M:2,Q:4,S:4,T:2,V:1,Z:0},Y=["a","c","h","l","m","q","s","t","v"],j=["xAxisRotation","largeArcFlag","sweepFlag"],u=function(e){for(var t,n=e.d,r=n.match(G),i=n.split(G).map(function(e){return e.replace(/[0-9]+-/g,function(e){return e.slice(0,-1)+" -"})}).map(function(e){return e.replace(/\.[0-9]+/g,function(e){return e+" "})}).map(function(e){return e.trim()}).filter(function(e){return 0<e.length}).map(function(e){return e.split(/[ ,]+/).map(parseFloat).filter(function(e){return!isNaN(e)})}),o=[],s=void 0,a=0,u=r.length;a<u;a++){var h=r[a],l=h.toUpperCase(),c=L[l],d=(t=h,-1!==Y.indexOf(t));if(0<c)for(var f=i.shift(),p=f.length/c,y=0;y<p;y++){var v=o[o.length-1]||{x:0,y:0};switch(l){case"M":var m=(d?v.x:0)+f.shift(),g=(d?v.y:0)+f.shift();0===y?(s={x:m,y:g},o.push({x:m,y:g,moveTo:!0})):o.push({x:m,y:g});break;case"L":o.push({x:(d?v.x:0)+f.shift(),y:(d?v.y:0)+f.shift()});break;case"H":o.push({x:(d?v.x:0)+f.shift(),y:v.y});break;case"V":o.push({x:v.x,y:(d?v.y:0)+f.shift()});break;case"A":o.push({curve:{type:"arc",rx:f.shift(),ry:f.shift(),xAxisRotation:f.shift(),largeArcFlag:f.shift(),sweepFlag:f.shift()},x:(d?v.x:0)+f.shift(),y:(d?v.y:0)+f.shift()});var b=!0,w=!1,M=void 0;try{for(var x,_=j[Symbol.iterator]();!(b=(x=_.next()).done);b=!0){var E=x.value;0===o[o.length-1].curve[E]&&delete o[o.length-1].curve[E]}}catch(e){w=!0,M=e}finally{try{!b&&_.return&&_.return()}finally{if(w)throw M}}break;case"C":o.push({curve:{type:"cubic",x1:(d?v.x:0)+f.shift(),y1:(d?v.y:0)+f.shift(),x2:(d?v.x:0)+f.shift(),y2:(d?v.y:0)+f.shift()},x:(d?v.x:0)+f.shift(),y:(d?v.y:0)+f.shift()});break;case"S":var S=(d?v.x:0)+f.shift(),I=(d?v.y:0)+f.shift(),N=(d?v.x:0)+f.shift(),C=(d?v.y:0)+f.shift(),A={},T=void 0,D=void 0;v.curve&&"cubic"===v.curve.type?(A.x=Math.abs(v.x-v.curve.x2),A.y=Math.abs(v.y-v.curve.y2),T=v.x<v.curve.x2?v.x-A.x:v.x+A.x,D=v.y<v.curve.y2?v.y-A.y:v.y+A.y):(A.x=Math.abs(N-S),A.y=Math.abs(C-I),T=v.x,D=v.y),o.push({curve:{type:"cubic",x1:T,y1:D,x2:S,y2:I},x:N,y:C});break;case"Q":o.push({curve:{type:"quadratic",x1:(d?v.x:0)+f.shift(),y1:(d?v.y:0)+f.shift()},x:(d?v.x:0)+f.shift(),y:(d?v.y:0)+f.shift()});break;case"T":var k=(d?v.x:0)+f.shift(),R=(d?v.y:0)+f.shift(),P=void 0,H=void 0;if(v.curve&&"quadratic"===v.curve.type){var O=Math.abs(v.x-v.curve.x1),B=Math.abs(v.y-v.curve.y1);P=v.x<v.curve.x1?v.x-O:v.x+O,H=v.y<v.curve.y1?v.y-B:v.y+B}else P=v.x,H=v.y;o.push({curve:{type:"quadratic",x1:P,y1:H},x:k,y:R})}}else{var F=o[o.length-1]||{x:0,y:0};F.x===s.x&&F.y===s.y||o.push({x:s.x,y:s.y})}}return o},h=function(e){var t=e.points;return c({closed:!0,points:t})},l=function(e){var t=e.points;return c({closed:!1,points:t})},c=function(e){var t=e.closed,n=e.points.split(/[\s,]+/).map(function(e){return parseFloat(e)}).reduce(function(e,t,n){return n%2==0?e.push({x:t}):e[(n-1)/2].y=t,e},[]);return t&&n.push(r({},n[0])),n[0].moveTo=!0,n},d=function(e){var t=e.height,n=e.rx,r=e.ry,i=e.width,o=e.x,s=e.y;return n||r?p({height:t,rx:n||r,ry:r||n,width:i,x:o,y:s}):f({height:t,width:i,x:o,y:s})},f=function(e){var t=e.height,n=e.width,r=e.x,i=e.y;return[{x:r,y:i,moveTo:!0},{x:r+n,y:i},{x:r+n,y:i+t},{x:r,y:i+t},{x:r,y:i}]},p=function(e){var t=e.height,n=e.rx,r=e.ry,i=e.width,o=e.x,s=e.y,a={type:"arc",rx:n,ry:r,sweepFlag:1};return[{x:o+n,y:s,moveTo:!0},{x:o+i-n,y:s},{x:o+i,y:s+r,curve:a},{x:o+i,y:s+t-r},{x:o+i-n,y:s+t,curve:a},{x:o+n,y:s+t},{x:o,y:s+t-r,curve:a},{x:o,y:s+r},{x:o+n,y:s,curve:a}]},y=function(e){return e.shapes.map(function(e){return i(e)})};n.default=i},{}],15:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)},r=function(e){var t=[{match:["circle","ellipse","line","path","polygon","polyline","rect","g"],prop:"type",required:!0,type:"string"}];switch(e.type){case"circle":t.push({prop:"cx",required:!0,type:"number"}),t.push({prop:"cy",required:!0,type:"number"}),t.push({prop:"r",required:!0,type:"number"});break;case"ellipse":t.push({prop:"cx",required:!0,type:"number"}),t.push({prop:"cy",required:!0,type:"number"}),t.push({prop:"rx",required:!0,type:"number"}),t.push({prop:"ry",required:!0,type:"number"});break;case"line":t.push({prop:"x1",required:!0,type:"number"}),t.push({prop:"x2",required:!0,type:"number"}),t.push({prop:"y1",required:!0,type:"number"}),t.push({prop:"y2",required:!0,type:"number"});break;case"path":t.push({prop:"d",required:!0,type:"string"});break;case"polygon":case"polyline":t.push({prop:"points",required:!0,type:"string"});break;case"rect":t.push({prop:"height",required:!0,type:"number"}),t.push({prop:"rx",type:"number"}),t.push({prop:"ry",type:"number"}),t.push({prop:"width",required:!0,type:"number"}),t.push({prop:"x",required:!0,type:"number"}),t.push({prop:"y",required:!0,type:"number"});break;case"g":t.push({prop:"shapes",required:!0,type:"array"})}return t};n.default=function(e){var t=function t(o){var e=r(o),s=[];if(e.map(function(e){var t=e.match,n=e.prop,r=e.required,i=e.type;void 0===o[n]?r&&s.push(n+" prop is required"+("type"===n?"":" on a "+o.type)):(void 0!==i&&("array"===i?Array.isArray(o[n])||s.push(n+" prop must be of type array"):a(o[n])!==i&&s.push(n+" prop must be of type "+i)),Array.isArray(t)&&-1===t.indexOf(o[n])&&s.push(n+" prop must be one of "+t.join(", ")))}),"g"===o.type&&Array.isArray(o.shapes)){var n=o.shapes.map(function(e){return t(e)});return[].concat.apply(s,n)}return s}(e);return{errors:t,valid:0===t.length}}},{}],16:[function(e,t,n){function r(e,t){if(!(this instanceof r))return new r(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||i,0<this.length)for(var n=(this.length>>1)-1;0<=n;n--)this._down(n)}function i(e,t){return e<t?-1:t<e?1:0}t.exports=r,(t.exports.default=r).prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,n=this.compare,r=t[e];0<e;){var i=e-1>>1,o=t[i];if(0<=n(r,o))break;t[e]=o,e=i}t[e]=r},_down:function(e){for(var t=this.data,n=this.compare,r=this.length>>1,i=t[e];e<r;){var o=1+(e<<1),s=o+1,a=t[o];if(s<this.length&&n(t[s],a)<0&&(a=t[o=s]),0<=n(a,i))break;t[e]=a,e=o}t[e]=i}}},{}],17:[function(e,a,t){!function e(t,n,r){var i=function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(!(this instanceof o))return new o(e,t);i(e)?(t=e[1],e=e[0]):"object"===_typeof2(e)&&e&&(t=e.y,e=e.x),this.x=o.clean(e||0),this.y=o.clean(t||0)}o.prototype={change:function(e){if("function"==typeof e)this.observers?this.observers.push(e):this.observers=[e];else if(this.observers&&this.observers.length)for(var t=this.observers.length-1;0<=t;t--)this.observers[t](this,e);return this},ignore:function(e){if(this.observers)if(e)for(var t=this.observers,n=t.length;n--;)t[n]===e&&t.splice(n,1);else this.observers=[];return this},set:function(e,t,n){if("number"!=typeof e&&(n=t,t=e.y,e=e.x),this.x===e&&this.y===t)return this;var r=null;return!1!==n&&this.observers&&this.observers.length&&(r=this.clone()),this.x=o.clean(e),this.y=o.clean(t),!1!==n?this.change(r):void 0},zero:function(){return this.set(0,0)},clone:function(){return new this.constructor(this.x,this.y)},negate:function(e){return e?new this.constructor(-this.x,-this.y):this.set(-this.x,-this.y)},add:function(e,t,n){return"number"!=typeof e&&(n=t,i(e)?(t=e[1],e=e[0]):(t=e.y,e=e.x)),e+=this.x,t+=this.y,n?new this.constructor(e,t):this.set(e,t)},subtract:function(e,t,n){return"number"!=typeof e&&(n=t,i(e)?(t=e[1],e=e[0]):(t=e.y,e=e.x)),e=this.x-e,t=this.y-t,n?new this.constructor(e,t):this.set(e,t)},multiply:function(e,t,n){return"number"!=typeof e?(n=t,i(e)?(t=e[1],e=e[0]):(t=e.y,e=e.x)):"number"!=typeof t&&(n=t,t=e),e*=this.x,t*=this.y,n?new this.constructor(e,t):this.set(e,t)},rotate:function(e,t,n){var r,i,o=this.x,s=this.y,a=Math.cos(e),u=Math.sin(e);return r=a*o-(t=t?-1:1)*u*s,i=t*u*o+a*s,n?new this.constructor(r,i):this.set(r,i)},length:function(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)},lengthSquared:function(){var e=this.x,t=this.y;return e*e+t*t},distance:function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)},nearest:function(e){for(var t,n=Number.MAX_VALUE,r=null,i=e.length-1;0<=i;i--)(t=this.distance(e[i]))<=n&&(n=t,r=e[i]);return r},normalize:function(e){var t=this.length(),n=t<Number.MIN_VALUE?0:1/t;return e?new this.constructor(this.x*n,this.y*n):this.set(this.x*n,this.y*n)},equal:function(e,t){return"number"!=typeof e&&(i(e)?(t=e[1],e=e[0]):(t=e.y,e=e.x)),o.clean(e)===this.x&&o.clean(t)===this.y},abs:function(e){var t=Math.abs(this.x),n=Math.abs(this.y);return e?new this.constructor(t,n):this.set(t,n)},min:function(e,t){var n=this.x,r=this.y,i=e.x,o=e.y,s=n<i?n:i,a=r<o?r:o;return t?new this.constructor(s,a):this.set(s,a)},max:function(e,t){var n=this.x,r=this.y,i=e.x,o=e.y,s=i<n?n:i,a=o<r?r:o;return t?new this.constructor(s,a):this.set(s,a)},clamp:function(e,t,n){var r=this.min(t,!0).max(e);return n?r:this.set(r.x,r.y)},lerp:function(e,t,n){return this.add(e.subtract(this,!0).multiply(t),n)},skew:function(e){return e?new this.constructor(-this.y,this.x):this.set(-this.y,this.x)},dot:function(e){return o.clean(this.x*e.x+e.y*this.y)},perpDot:function(e){return o.clean(this.x*e.y-this.y*e.x)},angleTo:function(e){return Math.atan2(this.perpDot(e),this.dot(e))},divide:function(e,t,n){if("number"!=typeof e?(n=t,i(e)?(t=e[1],e=e[0]):(t=e.y,e=e.x)):"number"!=typeof t&&(n=t,t=e),0===e||0===t)throw new Error("division by zero");if(isNaN(e)||isNaN(t))throw new Error("NaN detected");return n?new this.constructor(this.x/e,this.y/t):this.set(this.x/e,this.y/t)},isPointOnLine:function(e,t){return(e.y-this.y)*(e.x-t.x)==(e.y-t.y)*(e.x-this.x)},toArray:function(){return[this.x,this.y]},fromArray:function(e){return this.set(e[0],e[1])},toJSON:function(){return{x:this.x,y:this.y}},toString:function(){return"("+this.x+", "+this.y+")"},constructor:o},o.fromArray=function(e,t){return new(t||o)(e[0],e[1])},o.precision=n||8;var s=Math.pow(10,o.precision);return o.clean=t||function(e){if(isNaN(e))throw new Error("NaN detected");if(!isFinite(e))throw new Error("Infinity detected");return Math.round(e)===e?e:Math.round(e*s)/s},o.inject=e,t||(o.fast=e(function(e){return e}),void 0!==a&&"object"==_typeof2(a.exports)?a.exports=o:window.Vec2=window.Vec2||o),o}()},{}],18:[function(e,n,t){!function(e){function t(){if(t.prototype._singleton)throw new Error("WebMidi is a singleton, it cannot be instantiated directly.");(t.prototype._singleton=this)._inputs=[],this._outputs=[],this._userHandlers={},this._stateChangeQueue=[],this._processingStateChange=!1,this._midiInterfaceEvents=["connected","disconnected"],this._notes=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],this._semitones={C:0,D:2,E:4,F:5,G:7,A:9,B:11},Object.defineProperties(this,{MIDI_SYSTEM_MESSAGES:{value:{sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MESSAGES:{value:{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,channelmode:11,programchange:12,channelaftertouch:13,pitchbend:14},writable:!1,enumerable:!0,configurable:!1},MIDI_REGISTERED_PARAMETER:{value:{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]},writable:!1,enumerable:!0,configurable:!1},MIDI_CONTROL_CHANGE_MESSAGES:{value:{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101},writable:!1,enumerable:!0,configurable:!1},MIDI_CHANNEL_MODE_MESSAGES:{value:{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127},writable:!1,enumerable:!0,configurable:!1},octaveOffset:{value:0,writable:!0,enumerable:!0,configurable:!1}}),Object.defineProperties(this,{supported:{enumerable:!0,get:function(){return"requestMIDIAccess"in navigator}},enabled:{enumerable:!0,get:function(){return void 0!==this.interface}.bind(this)},inputs:{enumerable:!0,get:function(){return this._inputs}.bind(this)},outputs:{enumerable:!0,get:function(){return this._outputs}.bind(this)},sysexEnabled:{enumerable:!0,get:function(){return!(!this.interface||!this.interface.sysexEnabled)}.bind(this)},time:{enumerable:!0,get:function(){return performance.now()}}})}function i(e){var t=this;this._userHandlers={channel:{},system:{}},this._midiInput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiInput.connection}},id:{enumerable:!0,get:function(){return t._midiInput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiInput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiInput.name}},state:{enumerable:!0,get:function(){return t._midiInput.state}},type:{enumerable:!0,get:function(){return t._midiInput.type}}}),this._initializeUserHandlers(),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}function o(e){var t=this;this._midiOutput=e,Object.defineProperties(this,{connection:{enumerable:!0,get:function(){return t._midiOutput.connection}},id:{enumerable:!0,get:function(){return t._midiOutput.id}},manufacturer:{enumerable:!0,get:function(){return t._midiOutput.manufacturer}},name:{enumerable:!0,get:function(){return t._midiOutput.name}},state:{enumerable:!0,get:function(){return t._midiOutput.state}},type:{enumerable:!0,get:function(){return t._midiOutput.type}}})}var u=new t;t.prototype.enable=function(h,e){return this.enabled?void 0:this.supported?void navigator.requestMIDIAccess({sysex:e}).then(function(e){function t(){clearTimeout(n),this._updateInputsAndOutputs(),this.interface.onstatechange=this._onInterfaceStateChange.bind(this),"function"==typeof h&&h.call(this),r.forEach(function(e){this._onInterfaceStateChange(e)}.bind(this))}var n,r=[],i=[];this.interface=e,this._resetInterfaceUserHandlers(),this.interface.onstatechange=function(e){r.push(e)};for(var o=e.inputs.values(),s=o.next();s&&!s.done;s=o.next())i.push(s.value.open());for(var a=e.outputs.values(),u=a.next();u&&!u.done;u=a.next())i.push(u.value.open());n=setTimeout(t.bind(this),200),Promise&&Promise.all(i).catch(function(e){}).then(t.bind(this))}.bind(this),function(e){"function"==typeof h&&h.call(this,e)}.bind(this)):void("function"==typeof h&&h(new Error("The Web MIDI API is not supported by your browser.")))},t.prototype.disable=function(){if(!this.supported)throw new Error("The Web MIDI API is not supported by your browser.");this.interface&&(this.interface.onstatechange=void 0),this.interface=void 0,this._inputs=[],this._outputs=[],this._resetInterfaceUserHandlers()},t.prototype.addListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before adding event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(e)))throw new TypeError("The specified event type is not supported.");return this._userHandlers[e].push(t),this},t.prototype.hasListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before checking event listeners.");if("function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(!(0<=this._midiInterfaceEvents.indexOf(e)))throw new TypeError("The specified event type is not supported.");for(var n=0;n<this._userHandlers[e].length;n++)if(this._userHandlers[e][n]===t)return!0;return!1},t.prototype.removeListener=function(e,t){if(!this.enabled)throw new Error("WebMidi must be enabled before removing event listeners.");if(void 0!==t&&"function"!=typeof t)throw new TypeError("The 'listener' parameter must be a function.");if(0<=this._midiInterfaceEvents.indexOf(e))if(t)for(var n=0;n<this._userHandlers[e].length;n++)this._userHandlers[e][n]===t&&this._userHandlers[e].splice(n,1);else this._userHandlers[e]=[];else{if(void 0!==e)throw new TypeError("The specified event type is not supported.");this._resetInterfaceUserHandlers()}return this},t.prototype.toMIDIChannels=function(e){var t;return-1<(t="all"===e||void 0===e?["all"]:Array.isArray(e)?e:[e]).indexOf("all")&&(t=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),t.map(function(e){return parseInt(e)}).filter(function(e){return 1<=e&&e<=16})},t.prototype.getInputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.inputs.length;t++)if(this.inputs[t].id===e)return this.inputs[t];return!1},t.prototype.getOutputById=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.outputs.length;t++)if(this.outputs[t].id===e)return this.outputs[t];return!1},t.prototype.getInputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.inputs.length;t++)if(~this.inputs[t].name.indexOf(e))return this.inputs[t];return!1},t.prototype.getOctave=function(e){return null!=e&&0<=e&&e<=127?Math.floor(Math.floor(e)/12-1)+Math.floor(u.octaveOffset):void 0},t.prototype.getOutputByName=function(e){if(!this.enabled)throw new Error("WebMidi is not enabled.");for(var t=0;t<this.outputs.length;t++)if(~this.outputs[t].name.indexOf(e))return this.outputs[t];return!1},t.prototype.guessNoteNumber=function(e){var t=!1;if(e&&e.toFixed&&0<=e&&e<=127?t=Math.round(e):0<=parseInt(e)&&parseInt(e)<=127?t=parseInt(e):("string"==typeof e||e instanceof String)&&(t=this.noteNameToNumber(e)),!1===t)throw new Error("Invalid input value ("+e+").");return t},t.prototype.noteNameToNumber=function(e){"string"!=typeof e&&(e="");var t=e.match(/([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)/i);if(!t)throw new RangeError("Invalid note name.");var n=u._semitones[t[1].toUpperCase()],r=12*(parseInt(t[3])+1-Math.floor(u.octaveOffset))+n;if(-1<t[2].toLowerCase().indexOf("b")?r-=t[2].length:-1<t[2].toLowerCase().indexOf("#")&&(r+=t[2].length),r<0||127<r)throw new RangeError("Invalid note name or note outside valid range.");return r},t.prototype._updateInputsAndOutputs=function(){this._updateInputs(),this._updateOutputs()},t.prototype._updateInputs=function(){for(var e=0;e<this._inputs.length;e++){for(var t=!0,n=this.interface.inputs.values(),r=n.next();r&&!r.done;r=n.next())if(this._inputs[e]._midiInput===r.value){t=!1;break}t&&this._inputs.splice(e,1)}this.interface&&this.interface.inputs.forEach(function(e){for(var t=!0,n=0;n<this._inputs.length;n++)this._inputs[n]._midiInput===e&&(t=!1);t&&this._inputs.push(new i(e))}.bind(this))},t.prototype._updateOutputs=function(){for(var e=0;e<this._outputs.length;e++){for(var t=!0,n=this.interface.outputs.values(),r=n.next();r&&!r.done;r=n.next())if(this._outputs[e]._midiOutput===r.value){t=!1;break}t&&this._outputs.splice(e,1)}this.interface&&this.interface.outputs.forEach(function(e){for(var t=!0,n=0;n<this._outputs.length;n++)this._outputs[n]._midiOutput===e&&(t=!1);t&&this._outputs.push(new o(e))}.bind(this))},t.prototype._onInterfaceStateChange=function(e){this._updateInputsAndOutputs();var t={timestamp:e.timeStamp,type:e.port.state};this.interface&&"connected"===e.port.state?"output"===e.port.type?t.port=this.getOutputById(e.port.id):"input"===e.port.type&&(t.port=this.getInputById(e.port.id)):t.port={connection:"closed",id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this._userHandlers[e.port.state].forEach(function(e){e(t)})},t.prototype._resetInterfaceUserHandlers=function(){for(var e=0;e<this._midiInterfaceEvents.length;e++)this._userHandlers[this._midiInterfaceEvents[e]]=[]},i.prototype.on=i.prototype.addListener=function(t,e,n){var r=this;if(void 0===e&&(e="all"),Array.isArray(e)||(e=[e]),e.forEach(function(e){if("all"!==e&&!(1<=e&&e<=16))throw new RangeError("The 'channel' parameter is invalid.")}),"function"!=typeof n)throw new TypeError("The 'listener' parameter must be a function.");if(void 0!==u.MIDI_SYSTEM_MESSAGES[t])this._userHandlers.system[t]||(this._userHandlers.system[t]=[]),this._userHandlers.system[t].push(n);else{if(void 0===u.MIDI_CHANNEL_MESSAGES[t])throw new TypeError("The specified event type is not supported.");if(-1<e.indexOf("all")){e=[];for(var i=1;i<=16;i++)e.push(i)}this._userHandlers.channel[t]||(this._userHandlers.channel[t]=[]),e.forEach(function(e){r._userHandlers.channel[t][e]||(r._userHandlers.channel[t][e]=[]),r._userHandlers.channel[t][e].push(n)})}return this},i.prototype.hasListener=function(n,e,r){var i=this;if("function"!=typeof r)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===e&&(e="all"),e.constructor!==Array&&(e=[e]),void 0!==u.MIDI_SYSTEM_MESSAGES[n]){for(var t=0;t<this._userHandlers.system[n].length;t++)if(this._userHandlers.system[n][t]===r)return!0}else if(void 0!==u.MIDI_CHANNEL_MESSAGES[n]){if(-1<e.indexOf("all")){e=[];for(var o=1;o<=16;o++)e.push(o)}return!!this._userHandlers.channel[n]&&e.every(function(e){var t=i._userHandlers.channel[n][e];return t&&-1<t.indexOf(r)})}return!1},i.prototype.removeListener=function(r,e,i){var o=this;if(void 0!==i&&"function"!=typeof i)throw new TypeError("The 'listener' parameter must be a function.");if(void 0===e&&(e="all"),e.constructor!==Array&&(e=[e]),void 0!==u.MIDI_SYSTEM_MESSAGES[r])if(void 0===i)this._userHandlers.system[r]=[];else for(var t=0;t<this._userHandlers.system[r].length;t++)this._userHandlers.system[r][t]===i&&this._userHandlers.system[r].splice(t,1);else if(void 0!==u.MIDI_CHANNEL_MESSAGES[r]){if(-1<e.indexOf("all")){e=[];for(var n=1;n<=16;n++)e.push(n)}if(!this._userHandlers.channel[r])return this;e.forEach(function(e){var t=o._userHandlers.channel[r][e];if(t)if(void 0===i)o._userHandlers.channel[r][e]=[];else for(var n=0;n<t.length;n++)t[n]===i&&t.splice(n,1)})}else{if(void 0!==r)throw new TypeError("The specified event type is not supported.");this._initializeUserHandlers()}return this},i.prototype._initializeUserHandlers=function(){for(var e in u.MIDI_CHANNEL_MESSAGES)u.MIDI_CHANNEL_MESSAGES.hasOwnProperty(e)&&(this._userHandlers.channel[e]={});for(var t in u.MIDI_SYSTEM_MESSAGES)u.MIDI_SYSTEM_MESSAGES.hasOwnProperty(t)&&(this._userHandlers.system[t]=[])},i.prototype._onMidiMessage=function(e){if(0<this._userHandlers.system.midimessage.length){var t={target:this,data:e.data,timestamp:e.timeStamp,type:"midimessage"};this._userHandlers.system.midimessage.forEach(function(e){e(t)})}e.data[0]<240?this._parseChannelEvent(e):e.data[0]<=255&&this._parseSystemEvent(e)},i.prototype._parseChannelEvent=function(e){var t,n,r=e.data[0]>>4,i=1+(15&e.data[0]);1<e.data.length&&(t=e.data[1],n=2<e.data.length?e.data[2]:void 0);var o={target:this,data:e.data,timestamp:e.timeStamp,channel:i};r===u.MIDI_CHANNEL_MESSAGES.noteoff||r===u.MIDI_CHANNEL_MESSAGES.noteon&&0===n?(o.type="noteoff",o.note={number:t,name:u._notes[t%12],octave:u.getOctave(t)},o.velocity=n/127,o.rawVelocity=n):r===u.MIDI_CHANNEL_MESSAGES.noteon?(o.type="noteon",o.note={number:t,name:u._notes[t%12],octave:u.getOctave(t)},o.velocity=n/127,o.rawVelocity=n):r===u.MIDI_CHANNEL_MESSAGES.keyaftertouch?(o.type="keyaftertouch",o.note={number:t,name:u._notes[t%12],octave:u.getOctave(t)},o.value=n/127):r===u.MIDI_CHANNEL_MESSAGES.controlchange&&0<=t&&t<=119?(o.type="controlchange",o.controller={number:t,name:this.getCcNameByNumber(t)},o.value=n):r===u.MIDI_CHANNEL_MESSAGES.channelmode&&120<=t&&t<=127?(o.type="channelmode",o.controller={number:t,name:this.getChannelModeByNumber(t)},o.value=n):r===u.MIDI_CHANNEL_MESSAGES.programchange?(o.type="programchange",o.value=t):r===u.MIDI_CHANNEL_MESSAGES.channelaftertouch?(o.type="channelaftertouch",o.value=t/127):r===u.MIDI_CHANNEL_MESSAGES.pitchbend?(o.type="pitchbend",o.value=((n<<7)+t-8192)/8192):o.type="unknownchannelmessage",this._userHandlers.channel[o.type]&&this._userHandlers.channel[o.type][i]&&this._userHandlers.channel[o.type][i].forEach(function(e){e(o)})},i.prototype.getCcNameByNumber=function(e){if(!(0<=(e=Math.floor(e))&&e<=119))throw new RangeError("The control change number must be between 0 and 119.");for(var t in u.MIDI_CONTROL_CHANGE_MESSAGES)if(u.MIDI_CONTROL_CHANGE_MESSAGES.hasOwnProperty(t)&&e===u.MIDI_CONTROL_CHANGE_MESSAGES[t])return t},i.prototype.getChannelModeByNumber=function(e){if(!(120<=(e=Math.floor(e))&&status<=127))throw new RangeError("The control change number must be between 120 and 127.");for(var t in u.MIDI_CHANNEL_MODE_MESSAGES)if(u.MIDI_CHANNEL_MODE_MESSAGES.hasOwnProperty(t)&&e===u.MIDI_CHANNEL_MODE_MESSAGES[t])return t},i.prototype._parseSystemEvent=function(e){var t=e.data[0],n={target:this,data:e.data,timestamp:e.timeStamp};t===u.MIDI_SYSTEM_MESSAGES.sysex?n.type="sysex":t===u.MIDI_SYSTEM_MESSAGES.timecode?n.type="timecode":t===u.MIDI_SYSTEM_MESSAGES.songposition?n.type="songposition":t===u.MIDI_SYSTEM_MESSAGES.songselect?(n.type="songselect",n.song=e.data[1]):t===u.MIDI_SYSTEM_MESSAGES.tuningrequest?n.type="tuningrequest":t===u.MIDI_SYSTEM_MESSAGES.clock?n.type="clock":t===u.MIDI_SYSTEM_MESSAGES.start?n.type="start":t===u.MIDI_SYSTEM_MESSAGES.continue?n.type="continue":t===u.MIDI_SYSTEM_MESSAGES.stop?n.type="stop":t===u.MIDI_SYSTEM_MESSAGES.activesensing?n.type="activesensing":t===u.MIDI_SYSTEM_MESSAGES.reset?n.type="reset":n.type="unknownsystemmessage",this._userHandlers.system[n.type]&&this._userHandlers.system[n.type].forEach(function(e){e(n)})},o.prototype.send=function(e,t,n){if(!(128<=e&&e<=255))throw new RangeError("The status byte must be an integer between 128 (0x80) and 255 (0xFF).");void 0===t&&(t=[]),Array.isArray(t)||(t=[t]);var r=[];return t.forEach(function(e,t){var n=Math.floor(e);if(!(0<=n&&n<=255))throw new RangeError("Data bytes must be integers between 0 (0x00) and 255 (0xFF).");r.push(n)}),this._midiOutput.send([e].concat(r),parseFloat(n)||0),this},o.prototype.sendSysex=function(e,t,n){if(!u.sysexEnabled)throw new Error("Sysex message support must first be activated.");return n=n||{},e=[].concat(e),t.forEach(function(e){if(e<0||127<e)throw new RangeError("The data bytes of a sysex message must be integers between 0 (0x00) and 127 (0x7F).")}),t=e.concat(t,u.MIDI_SYSTEM_MESSAGES.sysexend),this.send(u.MIDI_SYSTEM_MESSAGES.sysex,t,this._parseTimeParameter(n.time)),this},o.prototype.sendTimecodeQuarterFrame=function(e,t){return t=t||{},this.send(u.MIDI_SYSTEM_MESSAGES.timecode,e,this._parseTimeParameter(t.time)),this},o.prototype.sendSongPosition=function(e,t){t=t||{};var n=(e=Math.floor(e)||0)>>7&127,r=127&e;return this.send(u.MIDI_SYSTEM_MESSAGES.songposition,[n,r],this._parseTimeParameter(t.time)),this},o.prototype.sendSongSelect=function(e,t){if(t=t||{},!(0<=(e=Math.floor(e))&&e<=127))throw new RangeError("The song number must be between 0 and 127.");return this.send(u.MIDI_SYSTEM_MESSAGES.songselect,[e],this._parseTimeParameter(t.time)),this},o.prototype.sendTuningRequest=function(e){return e=e||{},this.send(u.MIDI_SYSTEM_MESSAGES.tuningrequest,void 0,this._parseTimeParameter(e.time)),this},o.prototype.sendClock=function(e){return e=e||{},this.send(u.MIDI_SYSTEM_MESSAGES.clock,void 0,this._parseTimeParameter(e.time)),this},o.prototype.sendStart=function(e){return e=e||{},this.send(u.MIDI_SYSTEM_MESSAGES.start,void 0,this._parseTimeParameter(e.time)),this},o.prototype.sendContinue=function(e){return e=e||{},this.send(u.MIDI_SYSTEM_MESSAGES.continue,void 0,this._parseTimeParameter(e.time)),this},o.prototype.sendStop=function(e){return e=e||{},this.send(u.MIDI_SYSTEM_MESSAGES.stop,void 0,this._parseTimeParameter(e.time)),this},o.prototype.sendActiveSensing=function(e){return e=e||{},this.send(u.MIDI_SYSTEM_MESSAGES.activesensing,[],this._parseTimeParameter(e.time)),this},o.prototype.sendReset=function(e){return e=e||{},this.send(u.MIDI_SYSTEM_MESSAGES.reset,void 0,this._parseTimeParameter(e.time)),this},o.prototype.stopNote=function(e,n,r){if("all"===e)return this.sendChannelMode("allnotesoff",0,n,r);var i=64;return(r=r||{}).rawVelocity?!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=127&&(i=r.velocity):!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=1&&(i=127*r.velocity),this._convertNoteToArray(e).forEach(function(t){u.toMIDIChannels(n).forEach(function(e){this.send((u.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(e-1),[t,Math.round(i)],this._parseTimeParameter(r.time))}.bind(this))}.bind(this)),this},o.prototype.playNote=function(e,n,r){var i=64;if((r=r||{}).rawVelocity?!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=127&&(i=r.velocity):!isNaN(r.velocity)&&0<=r.velocity&&r.velocity<=1&&(i=127*r.velocity),r.time=this._parseTimeParameter(r.time),this._convertNoteToArray(e).forEach(function(t){u.toMIDIChannels(n).forEach(function(e){this.send((u.MIDI_CHANNEL_MESSAGES.noteon<<4)+(e-1),[t,Math.round(i)],r.time)}.bind(this))}.bind(this)),!isNaN(r.duration)){r.duration<=0&&(r.duration=0);var o=64;r.rawVelocity?!isNaN(r.release)&&0<=r.release&&r.release<=127&&(o=r.release):!isNaN(r.release)&&0<=r.release&&r.release<=1&&(o=127*r.release),this._convertNoteToArray(e).forEach(function(t){u.toMIDIChannels(n).forEach(function(e){this.send((u.MIDI_CHANNEL_MESSAGES.noteoff<<4)+(e-1),[t,Math.round(o)],(r.time||u.time)+r.duration)}.bind(this))}.bind(this))}return this},o.prototype.sendKeyAftertouch=function(e,n,t,r){var i=this;if(r=r||{},n<1||16<n)throw new RangeError("The channel must be between 1 and 16.");(isNaN(t)||t<0||1<t)&&(t=.5);var o=Math.round(127*t);return this._convertNoteToArray(e).forEach(function(t){u.toMIDIChannels(n).forEach(function(e){i.send((u.MIDI_CHANNEL_MESSAGES.keyaftertouch<<4)+(e-1),[t,o],i._parseTimeParameter(r.time))})}),this},o.prototype.sendControlChange=function(t,n,e,r){if(r=r||{},"string"==typeof t){if(!(t=u.MIDI_CONTROL_CHANGE_MESSAGES[t]))throw new TypeError("Invalid controller name.")}else if(!(0<=(t=Math.floor(t))&&t<=119))throw new RangeError("Controller numbers must be between 0 and 119.");if(!(0<=(n=Math.floor(n)||0)&&n<=127))throw new RangeError("Controller value must be between 0 and 127.");return u.toMIDIChannels(e).forEach(function(e){this.send((u.MIDI_CHANNEL_MESSAGES.controlchange<<4)+(e-1),[t,n],this._parseTimeParameter(r.time))}.bind(this)),this},o.prototype._selectRegisteredParameter=function(t,n,r){var i=this;if(t[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The control65 value must be between 0 and 127");if(t[1]=Math.floor(t[1]),!(0<=t[1]&&t[1]<=127))throw new RangeError("The control64 value must be between 0 and 127");return u.toMIDIChannels(n).forEach(function(e){i.sendControlChange(101,t[0],n,{time:r}),i.sendControlChange(100,t[1],n,{time:r})}),this},o.prototype._selectNonRegisteredParameter=function(t,n,r){var i=this;if(t[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The control63 value must be between 0 and 127");if(t[1]=Math.floor(t[1]),!(0<=t[1]&&t[1]<=127))throw new RangeError("The control62 value must be between 0 and 127");return u.toMIDIChannels(n).forEach(function(e){i.sendControlChange(99,t[0],n,{time:r}),i.sendControlChange(98,t[1],n,{time:r})}),this},o.prototype._setCurrentRegisteredParameter=function(t,n,r){var i=this;if((t=[].concat(t))[0]=Math.floor(t[0]),!(0<=t[0]&&t[0]<=127))throw new RangeError("The msb value must be between 0 and 127");return u.toMIDIChannels(n).forEach(function(e){i.sendControlChange(6,t[0],n,{time:r})}),t[1]=Math.floor(t[1]),0<=t[1]&&t[1]<=127&&u.toMIDIChannels(n).forEach(function(e){i.sendControlChange(38,t[1],n,{time:r})}),this},o.prototype._deselectRegisteredParameter=function(t,n){var r=this;return u.toMIDIChannels(t).forEach(function(e){r.sendControlChange(101,127,t,{time:n}),r.sendControlChange(100,127,t,{time:n})}),this},o.prototype.setRegisteredParameter=function(t,n,r,i){var o=this;if(i=i||{},!Array.isArray(t)){if(!u.MIDI_REGISTERED_PARAMETER[t])throw new Error("The specified parameter is not available.");t=u.MIDI_REGISTERED_PARAMETER[t]}return u.toMIDIChannels(r).forEach(function(e){o._selectRegisteredParameter(t,r,i.time),o._setCurrentRegisteredParameter(n,r,i.time),o._deselectRegisteredParameter(r,i.time)}),this},o.prototype.setNonRegisteredParameter=function(t,n,r,i){var o=this;if(i=i||{},!(0<=t[0]&&t[0]<=127&&0<=t[1]&&t[1]<=127))throw new Error("Position 0 and 1 of the 2-position parameter array must both be between 0 and 127.");return n=[].concat(n),u.toMIDIChannels(r).forEach(function(e){o._selectNonRegisteredParameter(t,r,i.time),o._setCurrentRegisteredParameter(n,r,i.time),o._deselectRegisteredParameter(r,i.time)}),this},o.prototype.incrementRegisteredParameter=function(t,n,r){var i=this;if(r=r||{},!Array.isArray(t)){if(!u.MIDI_REGISTERED_PARAMETER[t])throw new Error("The specified parameter is not available.");t=u.MIDI_REGISTERED_PARAMETER[t]}return u.toMIDIChannels(n).forEach(function(e){i._selectRegisteredParameter(t,n,r.time),i.sendControlChange(96,0,n,{time:r.time}),i._deselectRegisteredParameter(n,r.time)}),this},o.prototype.decrementRegisteredParameter=function(t,n,r){if(r=r||{},!Array.isArray(t)){if(!u.MIDI_REGISTERED_PARAMETER[t])throw new TypeError("The specified parameter is not available.");t=u.MIDI_REGISTERED_PARAMETER[t]}return u.toMIDIChannels(n).forEach(function(e){this._selectRegisteredParameter(t,n,r.time),this.sendControlChange(97,0,n,{time:r.time}),this._deselectRegisteredParameter(n,r.time)}.bind(this)),this},o.prototype.setPitchBendRange=function(t,n,r,i){var o=this;if(i=i||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(n=Math.floor(n)||0)&&n<=127))throw new RangeError("The cents value must be between 0 and 127");return u.toMIDIChannels(r).forEach(function(e){o.setRegisteredParameter("pitchbendrange",[t,n],r,{time:i.time})}),this},o.prototype.setModulationRange=function(t,n,r,i){var o=this;if(i=i||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The semitones value must be between 0 and 127");if(!(0<=(n=Math.floor(n)||0)&&n<=127))throw new RangeError("The cents value must be between 0 and 127");return u.toMIDIChannels(r).forEach(function(e){o.setRegisteredParameter("modulationrange",[t,n],r,{time:i.time})}),this},o.prototype.setMasterTuning=function(e,t,n){var r=this;if(n=n||{},(e=parseFloat(e)||0)<=-65||64<=e)throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");var i=Math.floor(e)+64,o=e-Math.floor(e),s=(o=Math.round((o+1)/2*16383))>>7&127,a=127&o;return u.toMIDIChannels(t).forEach(function(e){r.setRegisteredParameter("channelcoarsetuning",i,t,{time:n.time}),r.setRegisteredParameter("channelfinetuning",[s,a],t,{time:n.time})}),this},o.prototype.setTuningProgram=function(t,n,r){var i=this;if(r=r||{},!(0<=(t=Math.floor(t))&&t<=127))throw new RangeError("The program value must be between 0 and 127");return u.toMIDIChannels(n).forEach(function(e){i.setRegisteredParameter("tuningprogram",t,n,{time:r.time})}),this},o.prototype.setTuningBank=function(t,n,r){var i=this;if(r=r||{},!(0<=(t=Math.floor(t)||0)&&t<=127))throw new RangeError("The bank value must be between 0 and 127");return u.toMIDIChannels(n).forEach(function(e){i.setRegisteredParameter("tuningbank",t,n,{time:r.time})}),this},o.prototype.sendChannelMode=function(t,n,e,r){if(r=r||{},"string"==typeof t){if(!(t=u.MIDI_CHANNEL_MODE_MESSAGES[t]))throw new TypeError("Invalid channel mode message name.")}else if(!(120<=(t=Math.floor(t))&&t<=127))throw new RangeError("Channel mode numerical identifiers must be between 120 and 127.");if((n=Math.floor(n)||0)<0||127<n)throw new RangeError("Value must be an integer between 0 and 127.");return u.toMIDIChannels(e).forEach(function(e){this.send((u.MIDI_CHANNEL_MESSAGES.channelmode<<4)+(e-1),[t,n],this._parseTimeParameter(r.time))}.bind(this)),this},o.prototype.sendProgramChange=function(t,e,n){var r=this;if(n=n||{},t=Math.floor(t),isNaN(t)||t<0||127<t)throw new RangeError("Program numbers must be between 0 and 127.");return u.toMIDIChannels(e).forEach(function(e){r.send((u.MIDI_CHANNEL_MESSAGES.programchange<<4)+(e-1),[t],r._parseTimeParameter(n.time))}),this},o.prototype.sendChannelAftertouch=function(e,t,n){var r=this;n=n||{},e=parseFloat(e),(isNaN(e)||e<0||1<e)&&(e=.5);var i=Math.round(127*e);return u.toMIDIChannels(t).forEach(function(e){r.send((u.MIDI_CHANNEL_MESSAGES.channelaftertouch<<4)+(e-1),[i],r._parseTimeParameter(n.time))}),this},o.prototype.sendPitchBend=function(e,t,n){var r=this;if(n=n||{},isNaN(e)||e<-1||1<e)throw new RangeError("Pitch bend value must be between -1 and 1.");var i=Math.round((e+1)/2*16383),o=i>>7&127,s=127&i;return u.toMIDIChannels(t).forEach(function(e){r.send((u.MIDI_CHANNEL_MESSAGES.pitchbend<<4)+(e-1),[s,o],r._parseTimeParameter(n.time))}),this},o.prototype._parseTimeParameter=function(e){var t,n;return"string"==typeof e&&"+"===e.substring(0,1)?(t=parseFloat(e))&&0<t&&(n=u.time+t):(t=parseFloat(e))>u.time&&(n=t),n},o.prototype._convertNoteToArray=function(e){var t=[];return Array.isArray(e)||(e=[e]),e.forEach(function(e){t.push(u.guessNoteNumber(e))}),t},"function"==typeof define&&"object"==_typeof2(define.amd)?define([],function(){return u}):void 0!==n&&n.exports?n.exports=u:e.WebMidi||(e.WebMidi=u)}(this)},{}]},{},[2]);